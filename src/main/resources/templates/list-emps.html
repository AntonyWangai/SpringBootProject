<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Employee Directory</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: #121212;
            color: #eee;
        }

        body.light-mode {
            background: #f5f5f5;
            color: #222;
        }

        /* Table wrapper */
        .table-wrapper {
            padding: 20px;
            border-radius: 12px;
            transition: background 0.3s, color 0.3s;
        }

        /* Table styles for dark/light mode */
        table {
            width: 100%;
            border-collapse: collapse;
            transition: background 0.3s, color 0.3s;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode table {
            background-color: #1e1e1e;
            color: #eee;
            border-color: #555;
        }

        body.light-mode table {
            background-color: #ffffff;
            color: #222;
            border-color: #ddd;
        }

        body.dark-mode thead {
            background-color: #0b1a2a;
            color: #fff;
        }

        body.light-mode thead {
            background-color: #e9ecef;
            color: #000;
        }

        tbody tr:hover {
            transform: scale(1.01);
            transition: all 0.25s ease;
        }

        body.dark-mode tbody tr:hover {
            background-color: rgba(255,255,255,0.15);
        }

        body.light-mode tbody tr:hover {
            background-color: rgba(0,0,0,0.08);
        }

        /* Buttons */
        .btn-custom {
            transition: all 0.35s ease;
            border-radius: 10px;
        }

        .btn-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        /* Theme toggle button */
        #themeToggleBtn {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.4s ease;
        }

        #themeToggleBtn.light {
            background-color: #333;
            color: #fff;
        }

        #themeToggleBtn.dark {
            background-color: #f1f1f1;
            color: #333;
        }
    </style>
</head>

<body class="dark-mode">

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-uppercase">Employee Directory</h1>

    <div class="d-flex gap-2">
        <!-- Theme toggle button -->
        <button id="themeToggleBtn" class="light">â˜€ Light Mode</button>

        <!-- Logout -->
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="btn btn-danger btn-custom px-4">
                Logout
            </button>
        </form>
    </div>
</div>

<!-- User info -->
<div class="mb-3">
    Logged in as:
    <strong sec:authentication="principal.username" class="text-info"></strong>
    |
    <span class="badge bg-primary"
          sec:authentication="principal.authorities"></span>
</div>

<!-- Add Employee -->
<a class="btn btn-primary btn-custom mb-3"
   sec:authorize="hasAnyRole('MANAGER','ADMIN')"
   th:href="@{/addEmployee}">
    + Add Employee
</a>

<!-- Table -->
<div class="table-wrapper">
    <table>
        <thead>
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th class="text-center">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="emp : ${employees}">
            <td th:text="${emp.first_name}"></td>
            <td th:text="${emp.last_name}"></td>
            <td th:text="${emp.email}"></td>
            <td class="text-center">
                <a sec:authorize="hasAnyRole('MANAGER','ADMIN')"
                   th:href="@{/updateEmployee(Id=${emp.id})}"
                   class="btn btn-info btn-sm btn-custom me-2">
                    Update
                </a>
                <a sec:authorize="hasRole('ADMIN')"
                   th:href="@{/deleteEmployee(Id=${emp.id})}"
                   class="btn btn-danger btn-sm btn-custom"
                   onclick="return confirm('Are you sure you want to delete this employee?');">
                    Delete
                </a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    const toggleBtn = document.getElementById("themeToggleBtn");
    const body = document.body;

    // Load theme from localStorage
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
        body.className = savedTheme;
        updateButton(savedTheme);
    }

    toggleBtn.addEventListener("click", () => {
        if (body.classList.contains("dark-mode")) {
            body.className = "light-mode";
            localStorage.setItem("theme", "light-mode");
            updateButton("light-mode");
        } else {
            body.className = "dark-mode";
            localStorage.setItem("theme", "dark-mode");
            updateButton("dark-mode");
        }
    });

    function updateButton(mode) {
        if (mode === "dark-mode") {
            toggleBtn.textContent = "â˜€ Light Mode";
            toggleBtn.className = "light";
        } else {
            toggleBtn.textContent = "ðŸŒ™ Dark Mode";
            toggleBtn.className = "dark";
        }
    }
</script>

</body>
</html>
